{% extends "base.html" %}

{% block title %}Text Summarizer - SmartStudy{% endblock %}

{% block content %}
<div class="bg-white dark:bg-slate-900 text-gray-900 dark:text-white transition-colors duration-300">
    <!-- Sidebar Navigation -->
    <div class="fixed left-0 top-0 h-full w-64 bg-white dark:bg-slate-800 border-r border-gray-200 dark:border-slate-700 transition-colors duration-300">
        <div class="p-6">
            <div class="flex items-center space-x-3 mb-8">
                <div class="w-8 h-8 bg-purple-600 rounded-lg flex items-center justify-center">
                    <i class="fas fa-brain text-white text-sm"></i>
                </div>
                <span class="text-xl font-bold">SmartStudy</span>
            </div>

            <nav class="space-y-2">
                <a href="{{ url_for('dashboard') }}" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="{{ url_for('assistant') }}" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors">
                    <i class="fas fa-robot"></i>
                    <span>AI Assistant</span>
                </a>
                <a href="{{ url_for('summarizer') }}" class="flex items-center space-x-3 px-4 py-3 rounded-lg bg-purple-600 text-white">
                    <i class="fas fa-file-text"></i>
                    <span>Summarizer</span>
                </a>
                <a href="{{ url_for('flashcards') }}" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors">
                    <i class="fas fa-cards-blank"></i>
                    <span>Flashcards</span>
                </a>
                <a href="{{ url_for('quiz') }}" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors">
                    <i class="fas fa-question-circle"></i>
                    <span>Quiz</span>
                </a>
                <a href="{{ url_for('progress') }}" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors">
                    <i class="fas fa-chart-line"></i>
                    <span>Progress</span>
                </a>
                <a href="{{ url_for('history') }}" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors">
                    <i class="fas fa-history"></i>
                    <span>History</span>
                </a>
            </nav>
        </div>
    </div>

    <!-- Top Header -->
    <div class="fixed top-0 right-0 left-64 h-16 bg-white dark:bg-slate-800 border-b border-gray-200 dark:border-slate-700 flex items-center justify-end px-6 z-10 transition-colors duration-300">
        <div class="flex items-center space-x-4">
            <!-- Theme Toggle -->
            <button id="theme-toggle" class="p-2 rounded-lg bg-gray-100 dark:bg-slate-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-slate-600 transition-colors">
                <i class="fas fa-sun dark:hidden"></i>
                <i class="fas fa-moon hidden dark:block"></i>
            </button>

            <a href="{{ url_for('logout') }}" class="text-gray-600 dark:text-gray-300 hover:text-red-600 dark:hover:text-red-400 font-medium transition-colors">
                <i class="fas fa-sign-out-alt mr-2"></i>Logout
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="ml-64 pt-16">
        <div class="p-6 bg-gradient-to-br from-purple-50 to-blue-50 dark:from-slate-900 dark:via-purple-900 dark:to-slate-900 min-h-screen transition-colors duration-300">
            <div class="max-w-4xl mx-auto">
                <!-- Header -->
                <div class="bg-white dark:bg-slate-800 rounded-2xl p-8 mb-8 border border-gray-200 dark:border-slate-700 transition-colors duration-300">
                    <div class="flex items-center space-x-3 mb-4">
                        <div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center">
                            <i class="fas fa-file-text text-white text-xl"></i>
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Text Summarizer</h1>
                            <p class="text-gray-600 dark:text-gray-300">Transform lengthy texts into concise summaries</p>
                        </div>
                    </div>
                </div>

                <!-- Input Section -->
                <div class="bg-white dark:bg-slate-800 rounded-2xl p-8 mb-8 border border-gray-200 dark:border-slate-700 transition-colors duration-300">
                    <form id="summarizer-form" method="POST" enctype="multipart/form-data" class="space-y-6">
                        <!-- File Upload -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Upload Text File
                            </label>
                            <div class="flex items-center justify-center w-full">
                                <label for="file-upload" class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 dark:border-slate-600 border-dashed rounded-lg cursor-pointer bg-gray-50 dark:bg-slate-700 hover:bg-gray-100 dark:hover:bg-slate-600 transition-colors">
                                    <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                        <i class="fas fa-cloud-upload-alt text-gray-400 text-2xl mb-2"></i>
                                        <p class="mb-2 text-sm text-gray-500 dark:text-gray-400">
                                            <span class="font-semibold">Click to upload</span> or drag and drop
                                        </p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">TXT files only</p>
                                    </div>
                                    <input id="file-upload" name="file" type="file" accept=".txt" class="hidden" onchange="handleFileUpload(this)">
                                </label>
                            </div>
                            <div id="file-info" class="mt-2 text-sm text-gray-600 dark:text-gray-400 hidden"></div>
                        </div>

                        <div class="text-center text-gray-500 dark:text-gray-400">or</div>

                        <!-- Text Input -->
                        <div>
                            <label for="text-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Paste Your Text
                            </label>
                            <textarea 
                                id="text-input" 
                                name="text" 
                                rows="10" 
                                class="w-full px-4 py-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors resize-none"
                                placeholder="Enter the text you want to summarize here..."
                            ></textarea>
                        </div>

                        <!-- Options -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="summary-length" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Summary Length
                                </label>
                                <select id="summary-length" name="length" class="w-full px-4 py-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors">
                                    <option value="short">Short (2-3 sentences)</option>
                                    <option value="medium" selected>Medium (1 paragraph)</option>
                                    <option value="long">Long (2-3 paragraphs)</option>
                                </select>
                            </div>

                            <div>
                                <label for="summary-style" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Summary Style
                                </label>
                                <select id="summary-style" name="style" class="w-full px-4 py-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors">
                                    <option value="general" selected>General Summary</option>
                                    <option value="bullet">Bullet Points</option>
                                    <option value="academic">Academic Style</option>
                                    <option value="simple">Simple Language</option>
                                </select>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <button 
                            type="submit" 
                            id="summarize-btn"
                            class="w-full bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-semibold py-4 px-6 rounded-lg transition-colors flex items-center justify-center space-x-2"
                        >
                            <i class="fas fa-magic"></i>
                            <span>Generate Summary</span>
                        </button>
                    </form>
                </div>

                <!-- Output Section -->
                <div id="output-section" class="bg-white dark:bg-slate-800 rounded-2xl p-8 border border-gray-200 dark:border-slate-700 transition-colors duration-300 hidden">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold text-gray-900 dark:text-white">Summary</h2>
                        <div class="flex space-x-2">
                            <button onclick="copySummary()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">
                                <i class="fas fa-copy mr-2"></i>Copy
                            </button>
                            <button onclick="downloadSummary()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors">
                                <i class="fas fa-download mr-2"></i>Download
                            </button>
                        </div>
                    </div>
                    <div id="summary-output" class="prose dark:prose-invert max-w-none p-6 bg-gray-50 dark:bg-slate-700 rounded-lg border border-gray-200 dark:border-slate-600"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function handleFileUpload(input) {
    const file = input.files[0];
    const fileInfo = document.getElementById('file-info');

    if (file) {
        fileInfo.classList.remove('hidden');
        fileInfo.innerHTML = `<i class="fas fa-file-text mr-2"></i>Selected: ${file.name} (${(file.size/1024).toFixed(1)} KB)`;

        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('text-input').value = e.target.result;
        };
        reader.readAsText(file);
    } else {
        fileInfo.classList.add('hidden');
    }
}

document.getElementById('summarizer-form').addEventListener('submit', async function(e) {
    e.preventDefault();

    const btn = document.getElementById('summarize-btn');
    const outputSection = document.getElementById('output-section');
    const summaryOutput = document.getElementById('summary-output');

    const formData = new FormData(this);

    // Show loading state
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating Summary...';

    try {
        const response = await fetch('{{ url_for("summarizer") }}', {
            method: 'POST',
            body: formData
        });

        if (response.ok) {
            const result = await response.json();
            summaryOutput.innerHTML = `<p class="text-gray-900 dark:text-white leading-relaxed">${result.summary}</p>`;
            outputSection.classList.remove('hidden');
            outputSection.scrollIntoView({ behavior: 'smooth' });

            // Log activity
            if (window.SmartStudy) {
                window.SmartStudy.logActivity('summary_generated', 'Generated text summary');
                window.SmartStudy.updateProgress('summaries');
            }
        } else {
            throw new Error('Failed to generate summary');
        }
    } catch (error) {
        console.error('Error:', error);
        if (window.SmartStudy) {
            window.SmartStudy.showNotification('Error generating summary. Please try again.', 'error');
        }
    } finally {
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-magic mr-2"></i>Generate Summary';
    }
});

function copySummary() {
    const summaryText = document.getElementById('summary-output').textContent;
    navigator.clipboard.writeText(summaryText).then(() => {
        if (window.SmartStudy) {
            window.SmartStudy.showNotification('Summary copied to clipboard!', 'success');
        }
    });
}

function downloadSummary() {
    const summaryText = document.getElementById('summary-output').textContent;
    const blob = new Blob([summaryText], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'summary.txt';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);

    if (window.SmartStudy) {
        window.SmartStudy.showNotification('Summary downloaded!', 'success');
    }
}
</script>